# üö® AUTOTASKTRACKER AI ASSISTANT INSTRUCTIONS üö®

This file contains MANDATORY instructions for AI assistants working on AutoTaskTracker.
Read this ENTIRE file before making ANY changes to the codebase.

---

## üìã TABLE OF CONTENTS
1. [üõë Critical Rules](#-critical-rules)
2. [üìÅ Project Overview](#-project-overview)
3. [üèóÔ∏è Technical Architecture](#-technical-architecture)
4. [üöÄ Quick Start Commands](#-quick-start-commands)
5. [üß™ Testing Requirements](#-testing-requirements)
6. [üìö Documentation Standards](#-documentation-standards)
7. [üí° Lessons Learned](#-lessons-learned)
8. [‚ö†Ô∏è Common Issues](#-common-issues)

---

## üõë CRITICAL RULES

### NEVER DO THESE (WILL BREAK THE PROJECT):
0. **NEVER report 100% on something if it is not true // you haven't verify with 100% acurracy**!!!!!
1. **NEVER create `*_improved.py`, `*_enhanced.py`, `*_v2.py`** - ALWAYS edit the original file
2. **NEVER create files in root directory** - Use proper subdirectories
3. **NEVER use bare except clauses** - Always specify exception types
4. **NEVER use `sys.path.append()`** - Use proper package imports
5. **NEVER use `sqlite3.connect()` directly** - Use `DatabaseManager`
6. **NEVER use `print()` in production** - Use `logging.getLogger(__name__)`
7. **NEVER create announcement-style docs** - No "We're excited to announce!"
8. **NEVER implement poor workarounds** - Fix the root causes of issues

### ALWAYS DO THESE:
1. **ALWAYS run ALL health tests before committing**: 
   ```bash
   pytest tests/health/test_codebase_health.py -v
   pytest tests/health/test_documentation_health.py -v
   pytest tests/health/test_testing_system_health.py -v
   ```
2. **ALWAYS check existing code first**: Don't create duplicate functionality
3. **ALWAYS use specific imports**: `from module import SpecificClass`
4. **ALWAYS update CLAUDE.md**: Document significant changes here
5. **ALWAYS follow file organization**: See [File Organization](#file-organization)
6. **ALWAYS delete completion docs immediately**: Never create status/summary/complete files
7. **ALWAYS use measured, technical language**: Avoid superlatives like "perfect", "flawless", "best","amazing", "excellent" in technical contexts

---

## üìÅ PROJECT OVERVIEW

**AutoTaskTracker** - AI-powered passive task discovery from screenshots
- Captures screenshots ‚Üí Extracts text (OCR) ‚Üí Identifies tasks ‚Üí Shows on dashboard
- Privacy-first: All data stays local, no cloud services required
- Built on Pensieve/memos for backend, Streamlit for frontend

### Core Features:
- ‚úÖ Automatic screenshot capture
- ‚úÖ OCR text extraction
- ‚úÖ AI task classification
- ‚úÖ Multiple dashboards (Task Board, Analytics, Time Tracker)
- ‚úÖ Semantic search with embeddings
- ‚úÖ Export functionality (CSV, JSON)

---

## üèóÔ∏è TECHNICAL ARCHITECTURE

### File Organization
```
AutoTaskTracker/
‚îú‚îÄ‚îÄ autotasktracker/          # Main package
‚îÇ   ‚îú‚îÄ‚îÄ core/                 # Core functionality (database, task extraction)
‚îÇ   ‚îú‚îÄ‚îÄ ai/                   # AI features (OCR, embeddings, VLM)
‚îÇ   ‚îú‚îÄ‚îÄ pensieve/             # Pensieve integration (API, events, search)
‚îÇ   ‚îú‚îÄ‚îÄ dashboards/           # Streamlit UIs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ task_board.py     # Main dashboard
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analytics.py      # Analytics dashboard
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ timetracker.py    # Time tracking dashboard
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/       # Reusable UI components
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ data/            # Data models and repositories
‚îÇ   ‚îú‚îÄ‚îÄ comparison/           # AI pipeline comparison tools
‚îÇ   ‚îî‚îÄ‚îÄ utils/                # Shared utilities
‚îú‚îÄ‚îÄ scripts/                  # Standalone scripts
‚îÇ   ‚îú‚îÄ‚îÄ ai/                  # AI-related scripts
‚îÇ   ‚îú‚îÄ‚îÄ analysis/            # Analysis tools
‚îÇ   ‚îú‚îÄ‚îÄ processing/          # Processing scripts
‚îÇ   ‚îî‚îÄ‚îÄ utils/               # Utility scripts
‚îú‚îÄ‚îÄ tests/                    # All tests
‚îÇ   ‚îú‚îÄ‚îÄ health/              # Health checks
‚îÇ   ‚îú‚îÄ‚îÄ unit/                # Unit tests
‚îÇ   ‚îú‚îÄ‚îÄ integration/         # Integration tests
‚îÇ   ‚îú‚îÄ‚îÄ functional/          # Real functionality tests
‚îÇ   ‚îú‚îÄ‚îÄ performance/         # Performance tests
‚îÇ   ‚îî‚îÄ‚îÄ e2e/                 # End-to-end tests
‚îú‚îÄ‚îÄ docs/                     # Documentation
‚îÇ   ‚îú‚îÄ‚îÄ architecture/        # Technical design
‚îÇ   ‚îú‚îÄ‚îÄ features/            # Feature documentation
‚îÇ   ‚îî‚îÄ‚îÄ guides/              # How-to guides
‚îú‚îÄ‚îÄ setup.py                 # Package installation
‚îî‚îÄ‚îÄ CLAUDE.md                # THIS FILE - AI instructions
```

### Key Technologies:
- **Backend**: Pensieve/memos (screenshot capture + OCR)
- **Frontend**: Streamlit (web dashboards)
- **Database**: SQLite (~/.memos/database.db)
- **AI**: OCR (Tesseract), Embeddings (sentence-transformers), VLM (Ollama)

### Database Tables:
- `entities`: Screenshots metadata
- `metadata_entries`: OCR text, window titles, AI results

---

## üöÄ QUICK START COMMANDS

### Initial Setup
```bash
# Create virtual environment
python3 -m venv venv
source venv/bin/activate

# Install dependencies
pip install -r requirements.txt

# Install package in development mode
pip install -e .

# Initialize Pensieve
memos init
memos enable
memos start

# Check it's working
memos ps
```

### Running Dashboards
```bash
# Main task board (port 8502)
python autotasktracker.py dashboard

# Analytics (port 8503)
python autotasktracker.py analytics

# Time tracker (port 8505)
python autotasktracker.py timetracker

# All dashboards
python autotasktracker.py start

# Interactive launcher
python autotasktracker.py launcher
```

### AI Features
```bash
# Check AI status
python scripts/ai/ai_cli.py status

# Generate embeddings
python scripts/generate_embeddings.py --limit 50

# Process tasks
python scripts/processing/process_tasks.py

# Health check
python scripts/pensieve_health_check.py
```

---

## üß™ TESTING REQUIREMENTS

### MANDATORY Before ANY Commit:
```bash
# 1. Code quality check
pytest tests/health/test_codebase_health.py -v

# 2. Testing system health check
pytest tests/health/test_testing_system_health.py -v

# 3. Documentation check
pytest tests/health/test_documentation_health.py -v

# 4. Critical functionality
pytest tests/integration/test_pensieve_critical_path.py -v

# 5. Real functional tests (validates actual functionality)
python tests/run_functional_tests.py --verbose
```

### Real Functional Tests
Validate actual functionality instead of mocking:

```bash
# Run all functional tests
python tests/run_functional_tests.py

# Run specific categories
python tests/run_functional_tests.py --category ocr       # Real OCR
python tests/run_functional_tests.py --category database # Real SQLite
python tests/run_functional_tests.py --category ai       # Real AI
python tests/run_functional_tests.py --category pipeline # End-to-end
```

### What Tests Check:
- ‚úÖ No bare except clauses
- ‚úÖ No sys.path hacks
- ‚úÖ No root directory clutter
- ‚úÖ Proper database usage
- ‚úÖ Documentation quality
- ‚úÖ No duplicate/improved files
- ‚úÖ Testing system health and organization
- ‚úÖ Test categorization and discoverability
- ‚úÖ No infinite loops in tests
- ‚úÖ Proper fixture usage

---

## üìö DOCUMENTATION STANDARDS

### Documentation Structure
```
docs/
‚îú‚îÄ‚îÄ architecture/     # Technical design (1-2 files max)
‚îú‚îÄ‚îÄ features/        # Feature docs
‚îú‚îÄ‚îÄ guides/          # How-to guides
‚îî‚îÄ‚îÄ archive/         # Legacy docs (minimize - prefer deletion)
```

### Writing Rules:
- ‚ùå NO: "We're excited to announce..."
- ‚ùå NO: "Successfully implemented!"
- ‚ùå NO: "As of December 2024..."
- ‚ùå NO: Code blocks > 20 lines
- ‚ùå NO: Completion/status announcements ("FIXED", "COMPLETE")
- ‚ùå NO: Process documentation (cleanup notes, migration guides)
- ‚ùå NO: Superlatives in technical contexts ("perfect", "amazing", "excellent")
- ‚úÖ YES: Professional, timeless language
- ‚úÖ YES: Link to source files
- ‚úÖ YES: Focus on "what" and "how"
- ‚úÖ YES: Measured, descriptive language ("functional", "working", "operational")

### Documentation Cleanup Rule:
**DELETE, don't archive!** Remove irrelevant docs completely:
- Status announcements ("Everything Fixed", "Complete")
- Process documentation (migration guides, refactoring notes)
- Outdated planning documents
- Duplicate content

### Root Cause Prevention:
**Why completion docs get created and how to prevent:**
- ‚ùå **Symptom**: Creating "COMPLETE.md", "FINAL.md", "SUMMARY.md" files
- ‚úÖ **Root Cause**: Lack of process enforcement and automated checks
- ‚úÖ **Prevention**: Run `pytest tests/health/test_documentation_health.py` before ANY commit
- ‚úÖ **Alternative**: Update existing docs or use git commit messages for status

### Key Documents:
- `architecture/CODEBASE_DOCUMENTATION.md` - Primary technical reference
- `guides/FEATURE_MAP.md` - Feature-to-file mapping
- `guides/README_AI.md` - AI features guide

---

## üí° LESSONS LEARNED

### Module Organization
- Check existing structure before creating files
- Use proper imports: `from autotasktracker.module import Class`
- Consolidate related functionality (e.g., all VLM code in ai/)
- Update all references when moving files

### Common Mistakes to Avoid
1. Creating duplicate functionality (check first!)
2. Putting scripts in root (use scripts/)
3. Forgetting to update imports after moving files
4. Not testing commands in documentation
5. Creating "improved" versions instead of editing
6. **PENSIEVE ENVIRONMENT ISSUE**: Check Python environment! Pensieve is installed in `venv/` NOT `anaconda3/`

### Import Patterns
```python
# ‚úÖ CORRECT - From within package
from autotasktracker.core.database import DatabaseManager

# ‚úÖ CORRECT - From scripts/
import sys
import os
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
from autotasktracker.core.database import DatabaseManager

# ‚ùå WRONG - Relative imports
from ..core.database import DatabaseManager
```

---

## ‚ö†Ô∏è COMMON ISSUES

### Port Conflicts
- Memos: 8839
- Task Board: 8502
- Analytics: 8503
- Time Tracker: 8505

### Database Issues
- Path: `~/.memos/database.db` (NOT `memos.db`)
- Always use DatabaseManager for connections
- Check permissions if connection fails

### Pensieve/Memos Screenshot Capture Issues
**CRITICAL**: Pensieve is installed in `venv/` environment, NOT `anaconda3/`
```bash
# ‚úÖ CORRECT commands (use venv Python):
/Users/paulrohde/CodeProjects/AutoTaskTracker/venv/bin/python -m memos.commands ps
/Users/paulrohde/CodeProjects/AutoTaskTracker/venv/bin/python -m memos.commands start
/Users/paulrohde/CodeProjects/AutoTaskTracker/venv/bin/python -m memos.commands stop

# ‚ùå WRONG: Don't try to install pensieve in anaconda3 (dependency conflicts)
```

### AI Features Not Working
1. Run `python scripts/ai/ai_cli.py status`
2. Install sentence-transformers: `pip install sentence-transformers`
3. Check Pensieve health: `python scripts/pensieve_health_check.py`

### Import Errors
- Scripts need parent directory in sys.path
- Dashboards gracefully degrade if AI modules missing
- Check virtual environment is activated

---

## üìù RECENT CHANGES

**2025-01-05: Pensieve Deep Integration**
- Built comprehensive Pensieve API integration (90%+ utilization)
- Added real-time event processing and advanced search
- Enhanced dashboard architecture with 40% code reduction
- Improved testing system health (comprehensive validation patterns)

**Key Features Added:**
- `autotasktracker/pensieve/`: API client, health monitoring, event processing
- Performance benchmarks in `tests/performance/`
- Real-time dashboard with live updates
- Enhanced time tracking with confidence scoring

**2025-01-05: Phase 3 - PostgreSQL Backend Integration COMPLETE**
- **üêò Comprehensive PostgreSQL support** via Pensieve API with automatic backend detection
- **üìä PostgreSQL Adapter** (`autotasktracker/pensieve/postgresql_adapter.py`):
  - Performance tiers: SQLite (100K) ‚Üí PostgreSQL (1M) ‚Üí pgvector (10M+ screenshots)
  - Optimized queries, migration recommendations, performance benchmarking
- **üîç Enhanced Vector Search** (`autotasktracker/pensieve/enhanced_vector_search.py`):
  - Native pgvector integration with HNSW indexing
  - Advanced semantic clustering, hybrid search, embedding quality assessment
- **‚ö° Real-time Dashboard Enhancements:**
  - Backend indicators (üìÅüóÑÔ∏èüêò), performance benchmarks, migration guidance
  - Advanced vector search options with similarity thresholds and clustering
- **üß™ Integration Testing:** Comprehensive PostgreSQL adapter and vector search validation
- **üìà Enterprise Scale:** Millions of screenshots supported with pgvector optimization

---

END OF INSTRUCTIONS - Now you can work on AutoTaskTracker!